---
title: 学习大厂利用localStorage优化加载
date: 2018-01-29 14:48:54
categories:
tags: 前端
---
利用LocalStorage来对部分请求的数据和结果进行缓存，省去发送http请求所消耗的时间，从而提高网页的响应速度。
这类做法在移动端应用已经十分广泛。可以膜拜下鹅、猫、狗三家页面是如何利用LS来进行请求缓存的。

* ### 微信

利用LS来对js文件进行缓存。 如下图所示，用浏览器打开一篇微信公众账号文章，打开控制台，发现Network里竟然一个js文件都不需要加载？一脸懵逼！

![5](https://jackiedark.github.io/img/projects/5.png)

切到LS才哗然大悟，原来所有的JS都藏在这里了！

![4](https://jackiedark.github.io/img/projects/4.png)

微信就是利用了这种技巧来缓存关键路径里的js资源，从而大大加快了页面访问速度。
当然，实际实现起来，并不像表面看得那样，第一次访问时将js放到LS里，每次进来取出来执行这么简单，最核心的其实是需要设计一套缓存更新机制。首先我们对于缓存的js文件要通过后缀来设置独一无二的版本标识；其次，每次后端需要传一份资源配置文件，前端会根据这个配置文件来和LS中缓存的文件进行版本标识匹配，从而决定是利用LS缓存，还是重新发请求更新资源。例如，微信中的这个配置文件就是通过moon_map来同步输出给前端的，如下图所示：

![3](https://jackiedark.github.io/img/projects/3.png)


* ### 天猫

利用LS来对关键的XHR异步请求进行缓存。 以天猫超市首页为例： 如下图，查看LS，发现其对首屏中的轮播和10个分类入口的数据进行了缓存。


![2](https://jackiedark.github.io/img/projects/2.png)

上面的json内容，格式化后，发现其中包含banner和flowIcons这两个属性，里面的数据分别对应的就是轮播和分类入口的数据。这样就可以大大提升首屏的渲染展示时间。


* ### 京东
利用LS来对非关键请求进行缓存。以PC版的京东首页为例。京东反向思维，另辟奇径地采用了另一种方式来利用LS。那就是把非关键请求剥离出来存放在LS内。具体来说，对于首屏数据，还是正常加载和展示。但为了非首屏数据的加载和渲染会阻塞和抢占资源，从而影响首屏页面渲染。所以将非首屏资源的HTML/CSS等资源抽出来放在LS内，当页面滚动到可视区域时再去LS中获取数据，插入到dom中。这点很类似于现在的模块懒加载。如下图所示，每个LS里都包含了一个模块所需要的HTML/CSS的资源。

![1](https://jackiedark.github.io/img/projects/1.png)